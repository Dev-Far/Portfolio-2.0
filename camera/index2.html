<!DOCTYPE html>
<html>
<head>
  <title>Camera Recorder with Options</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
      margin: 0;
    }
    video, canvas {
      display: block;
      margin-bottom: 10px;
    }
    button {
      padding: 10px 20px;
      font-size: 16px;
    }
  </style>
</head>
<body>

  <video id="video" width="640" height="480" autoplay></video>
  <canvas id="canvas" width="640" height="480" style="display:none;"></canvas>
  <select id="camera-facing">
    <option value="user">Front Camera</option>
    <option value="environment">Rear Camera</option>
  </select>
  <select id="video-quality">
    <option value='{"width": {"ideal": 640}, "height": {"ideal": 480}}'>SD (480p)</option>
    <option value='{"width": {"ideal": 1280}, "height": {"ideal": 720}}'>HD (720p)</option>
    <option value='{"width": {"ideal": 1920}, "height": {"ideal": 1080}}'>Full HD (1080p)</option>    
  </select>
  <button id="start">Start Recording</button>
  <button id="stop" disabled>Stop Recording</button>
  <a id="download" style="display:none;">Download</a>

  <script>
    let mediaRecorder;
    let recordedChunks = [];
    let facingMode = 'user'; // Start with the front camera

    let currentStream;

    function setupCamera(facingMode, qualityConstraints) {
  const constraints = {
    video: { ...qualityConstraints, facingMode: facingMode },
    audio: true,
  };

  if (currentStream) {
    currentStream.getTracks().forEach((track) => track.stop());
  }

  

  navigator.mediaDevices
    .getUserMedia(constraints)
    .then(function (stream) {
      currentStream = stream;
      const video = document.getElementById("video");
      video.srcObject = stream;

      mediaRecorder = new MediaRecorder(stream);

      mediaRecorder.ondataavailable = function (event) {
        if (event.data.size > 0) {
          recordedChunks.push(event.data);
        }
      };

      mediaRecorder.onstop = function () {
        const blob = new Blob(recordedChunks, { type: "video/webm" });
        const url = URL.createObjectURL(blob);
        const download = document.getElementById("download");
        download.href = url;
        download.download = "recording.webm";
        download.style.display = "block";
      };

      // Enable "Start Recording" button
      document.getElementById("start").disabled = false;
    })
    .catch(function (err) {
      console.error("Error accessing media devices.", err);
    });
}

    setupCamera(facingMode, JSON.parse(document.getElementById('video-quality').value));

    document.getElementById('camera-facing').addEventListener('change', function() {
      facingMode = this.value;
      setupCamera(facingMode, JSON.parse(document.getElementById('video-quality').value));
    });

    document.getElementById('video-quality').addEventListener('change', function() {
      setupCamera(facingMode, JSON.parse(this.value));
    });

    document.getElementById("start").addEventListener("click", function () {
  if (mediaRecorder) {
    recordedChunks = [];
    mediaRecorder.start();
    document.getElementById("start").disabled = true;
    document.getElementById("stop").disabled = false;
  } else {
    console.error("MediaRecorder is not initialized.");
  }
});

    document.getElementById('stop').addEventListener('click', function() {
      mediaRecorder.stop();
      document.getElementById('start').disabled =
 false;
      document.getElementById('stop').disabled = true;
    });
  </script>

</body>
</html>